---
/**
 * Navigation Component
 * 
 * Top navigation bar with brand logo, menu links, and theme toggle.
 * Includes mobile burger menu and Projects dropdown functionality.
 */

const { pathname } = Astro.url;

const navItems = [
  { href: "/", label: "Home" },
  { href: "/approach/", label: "Approach" }
];

const projectItems = [
  { href: "/projects/corapan/", label: "CO.RA.PAN" },
  { href: "/projects/marele/", label: "MAR.ELE" },
  { href: "/projects/promat/", label: "Pronunciation Matters" },
  { href: "/projects/school/", label: "Spanische Linguistik @ School" },
  { href: "/projects/games/", label: "Games.Hispanistica" }
];

function isActive(href: string, currentPath: string): boolean {
  if (href === "/") {
    return currentPath === "/";
  }
  return currentPath.startsWith(href);
}

function isProjectsActive(currentPath: string): boolean {
  return currentPath.startsWith("/projects/");
}
---

<nav class="nav">
  <div class="nav__container">
    <a href="/" class="nav__brand">Hispanistica</a>
    
    <div class="nav__actions">
      <!-- Theme Toggle -->
      <button 
        class="nav__theme-toggle" 
        id="theme-toggle"
        aria-label="Toggle theme"
      >
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="theme-icon theme-icon--light">
          <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/>
        </svg>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="theme-icon theme-icon--dark">
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
        </svg>
      </button>
      
      <button class="nav__burger" aria-label="Toggle menu" id="nav-burger">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    
    <ul class="nav__menu" id="nav-menu">
      {navItems.map(item => (
        <li>
          <a 
            href={item.href} 
            class:list={[
              "nav__link",
              { "nav__link--active": isActive(item.href, pathname) }
            ]}
          >
            {item.label}
          </a>
        </li>
      ))}
      
      <!-- Projects Dropdown (Desktop only) -->
      <li class="nav__dropdown nav__dropdown--desktop">
        <button 
          class:list={[
            "nav__link nav__dropdown-toggle",
            { "nav__link--active": isProjectsActive(pathname) }
          ]}
          aria-expanded="false"
          aria-haspopup="true"
          id="projects-dropdown-toggle"
        >
          Projects
          <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true">
            <path d="M6 9L1 4h10L6 9z"/>
          </svg>
        </button>
        <ul class="nav__dropdown-menu" id="projects-dropdown-menu">
          {projectItems.map(item => (
            <li>
              <a 
                href={item.href}
                class:list={[
                  "nav__dropdown-link",
                  { "nav__dropdown-link--active": isActive(item.href, pathname) }
                ]}
              >
                {item.label}
              </a>
            </li>
          ))}
        </ul>
      </li>
      
      <!-- Projects Accordion (Mobile only) -->
      <li class="nav__accordion nav__accordion--mobile">
        <button 
          class:list={[
            "nav__link nav__accordion-toggle",
            { "nav__link--active": isProjectsActive(pathname) }
          ]}
          aria-expanded="false"
          aria-controls="projects-accordion-panel"
          id="projects-accordion-toggle"
        >
          Projects
          <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true" class="accordion-icon">
            <path d="M6 9L1 4h10L6 9z"/>
          </svg>
        </button>
        <ul class="nav__accordion-panel" id="projects-accordion-panel">
          {projectItems.map(item => (
            <li>
              <a 
                href={item.href}
                class:list={[
                  "nav__accordion-link",
                  { "nav__accordion-link--active": isActive(item.href, pathname) }
                ]}
              >
                {item.label}
              </a>
            </li>
          ))}
        </ul>
      </li>
      
      <!-- Theme Toggle (Desktop only - in menu) -->
      <li class="nav__theme-toggle-desktop">
        <button 
          class="nav__theme-toggle" 
          id="theme-toggle-desktop"
          aria-label="Toggle theme"
        >
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="theme-icon theme-icon--light">
            <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/>
          </svg>
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="theme-icon theme-icon--dark">
            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
          </svg>
        </button>
      </li>
    </ul>
  </div>
</nav>

<script>
  // Mobile navigation toggle
  const burger = document.getElementById('nav-burger');
  const menu = document.getElementById('nav-menu');
  
  if (burger && menu) {
    burger.addEventListener('click', () => {
      menu.classList.toggle('nav__menu--open');
      const isOpen = menu.classList.contains('nav__menu--open');
      burger.setAttribute('aria-expanded', String(isOpen));
    });
    
    document.addEventListener('click', (e) => {
      if (!burger.contains(e.target as Node) && !menu.contains(e.target as Node)) {
        menu.classList.remove('nav__menu--open');
        burger.setAttribute('aria-expanded', 'false');
      }
    });
    
    menu.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        menu.classList.remove('nav__menu--open');
        burger.setAttribute('aria-expanded', 'false');
      });
    });
  }
  
  // Desktop: Projects dropdown toggle
  const dropdownToggle = document.getElementById('projects-dropdown-toggle');
  const dropdownMenu = document.getElementById('projects-dropdown-menu');
  
  if (dropdownToggle && dropdownMenu) {
    dropdownToggle.addEventListener('click', (e) => {
      e.preventDefault();
      const isOpen = dropdownToggle.getAttribute('aria-expanded') === 'true';
      dropdownToggle.setAttribute('aria-expanded', String(!isOpen));
      dropdownMenu.classList.toggle('nav__dropdown-menu--open');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!dropdownToggle.contains(e.target as Node) && !dropdownMenu.contains(e.target as Node)) {
        dropdownToggle.setAttribute('aria-expanded', 'false');
        dropdownMenu.classList.remove('nav__dropdown-menu--open');
      }
    });
    
    // Keyboard navigation
    dropdownToggle.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        dropdownToggle.click();
      } else if (e.key === 'Escape') {
        dropdownToggle.setAttribute('aria-expanded', 'false');
        dropdownMenu.classList.remove('nav__dropdown-menu--open');
      }
    });
  }
  
  // Mobile: Projects accordion toggle
  const accordionToggle = document.getElementById('projects-accordion-toggle');
  const accordionPanel = document.getElementById('projects-accordion-panel');
  
  if (accordionToggle && accordionPanel) {
    accordionToggle.addEventListener('click', (e) => {
      e.preventDefault();
      const isOpen = accordionToggle.getAttribute('aria-expanded') === 'true';
      accordionToggle.setAttribute('aria-expanded', String(!isOpen));
      accordionPanel.classList.toggle('nav__accordion-panel--open');
    });
    
    // Keyboard navigation for accordion
    accordionToggle.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        accordionToggle.click();
      } else if (e.key === 'Escape') {
        accordionToggle.setAttribute('aria-expanded', 'false');
        accordionPanel.classList.remove('nav__accordion-panel--open');
      }
    });
  }
</script>
